<!-- index.html (post-double-rail-rectframe) -->
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>각관-평철 이중모듈 난간 | 고래이음 난간 시뮬레이터</title>

  <link rel="stylesheet" href="../../shared/css/app.css" />

  <style>
    body {
      margin: 0;
      display: flex;
      font-family: 'Pretendard', sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    #sidebar {
      width: 320px;
      padding: 18px 18px 22px;
      background: #fff;
      height: 100vh;
      overflow-y: auto;
      box-shadow: 2px 0 15px rgba(0, 0, 0, .05);
      z-index: 100;
    }

    #canvas-container {
      flex-grow: 1;
      position: relative;
      background: #eee;
    }

    .input-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
      font-weight: 700;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      box-sizing: border-box;
      font-size: 14px;
    }

    input[type="number"]:focus {
      border-color: #007bff;
      outline: none;
    }

    .pageTitle {
      font-size: 16px;
      font-weight: 900;
      margin: 8px 0 4px;
    }

    .pageSub {
      font-size: 12px;
      color: #777;
      margin: 0 0 14px;
      line-height: 1.5;
    }

    .row2 {
      display: flex;
      gap: 8px;
    }

    .row2 input {
      width: 50%;
    }

    .info-box {
      font-size: 11px;
      color: #888;
      line-height: 1.6;
      background: #f1f3f5;
      padding: 10px;
      border-radius: 10px;
      margin-top: 14px;
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, .82);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
      visibility: hidden;
      font-weight: 900;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f1f3f5;
      color: #495057;
      margin-top: 8px;
    }

    /* ===== Sidebar Sections (Accordion) ===== */
    .acc {
      border: 1px solid #e9ecef;
      border-radius: 12px;
      background: #fff;
      overflow: hidden;
      margin: 10px 0;
    }

    .acc>summary {
      list-style: none;
      cursor: pointer;
      user-select: none;
      padding: 12px 12px;
      font-size: 13px;
      font-weight: 900;
      color: #343a40;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fa;
      border-bottom: 1px solid #eef1f4;
    }

    .acc>summary::-webkit-details-marker {
      display: none;
    }

    .acc>summary .chev {
      font-weight: 900;
      color: #868e96;
      transform: rotate(0deg);
      transition: transform .15s ease;
    }

    .acc[open]>summary .chev {
      transform: rotate(90deg);
    }

    .acc-body {
      padding: 12px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-mini {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      background: #f3f5f7;
      color: #222;
      font-weight: 900;
      cursor: pointer;
      user-select: none;
      flex: 1;
      min-width: 88px;
    }

    .btn-mini.on {
      background: #e7f1ff;
      border-color: #a8ccff;
      color: #0b57d0;
    }

    .step-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #f1f3f5;
      margin-top: 10px;
      font-size: 12px;
      color: #495057;
      font-weight: 900;
    }

    .step-pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid #e9ecef;
      color: #0b57d0;
      font-weight: 900;
      font-size: 12px;
      min-width: 56px;
      text-align: center;
    }

    .tiny-help {
      font-size: 11px;
      color: #888;
      line-height: 1.5;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <header class="topbar" style="position:fixed; left:320px; right:0; top:0;">
    <a class="brand" href="#" id="brandLink">고래이음</a>
    <nav class="nav">
      <a href="#" id="homeLink">Home</a>
      <a class="active" href="../">Back</a>
    </nav>
  </header>

  <aside id="sidebar">
    <div class="badge">Railing / Post + Double Rail + RectFrame</div>
    <div class="pageTitle">각관-평철 이중모듈 난간</div>
    <p class="pageSub">
      포스트(각관) + 3단 가로재(하/중/상) + ㅁ자 모듈.<br>
      값 변경 시 3D 모델이 실시간 업데이트됩니다.
    </p>

    <!-- 1) 보기/공정(항상 펼침) -->
    <details class="acc" open>
      <summary>
        <span>1. 보기 및 공정 시뮬</span>
        <span class="chev">›</span>
      </summary>

      <div class="acc-body">
        <!-- 색 + 사람 토글 -->
        <div class="input-group" style="margin-top:0;">
          <label>색상 / 사람</label>
          <div style="display:flex; gap:10px; align-items:center;">
            <input type="color" id="allColor" value="#666666" style="flex:1; height:42px;" />
            <button id="btnHuman" class="btn-mini on" type="button" style="flex:0; min-width:110px;">사람 ON</button>
          </div>
        </div>

        <!-- 단계 -->
        <div class="step-box" style="margin-top:10px;">
          <span>단계</span>
          <span class="step-pill" id="buildStepLabel">0 / 5</span>
        </div>

        <div class="btn-row" style="margin-top:10px;">
          <button id="btnStepPrev" class="btn-mini" type="button">Prev</button>
          <button id="btnStepNext" class="btn-mini" type="button">Next</button>
          <button id="btnStepReset" class="btn-mini" type="button">Reset</button>
        </div>

        <!-- ON/OFF 토글 -->
        <div class="btn-row" style="margin-top:12px;">
          <button id="btnPosts" class="btn-mini on" type="button">포스트 ON</button>
          <button id="btnRailBot" class="btn-mini on" type="button">하부레일 ON</button>
          <button id="btnSlats" class="btn-mini on" type="button">ㅁ자모듈 ON</button>
          <button id="btnRailMid" class="btn-mini on" type="button">중간레일 ON</button>
          <button id="btnRailTop" class="btn-mini on" type="button">상부레일 ON</button>
        </div>

        <div class="tiny-help">
          * 단계(0~5): 0=없음 → 1=포스트 → 2=하부레일 → 3=ㅁ자모듈 → 4=중간레일 → 5=상부레일<br>
          * 토글을 수동으로 누르면 단계는 0으로 초기화됩니다.
        </div>
      </div>
    </details>

    <!-- 2) 전체 설정 -->
    <details class="acc">
      <summary>
        <span>2. 전체 설정</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>전체 길이 (mm)</label>
          <input type="number" id="totalL" value="3300">
        </div>
        <div class="input-group">
          <label>난간 높이 (mm) <span style="font-weight:400;">(상부레일 최상단 기준)</span></label>
          <input type="number" id="height" value="1200">
        </div>
      </div>
    </details>

    <!-- 3) 포스트 설정 -->
    <details class="acc">
      <summary>
        <span>3. 포스트 설정</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>포스트 간격 (mm)</label>
          <input type="number" id="postInt" value="1100">
        </div>
        <div class="input-group">
          <label>포스트 각관 W/H (mm)</label>
          <div class="row2">
            <input type="number" id="postW" value="20" title="포스트 폭 W">
            <input type="number" id="postH" value="50" title="포스트 높이 H">
          </div>
        </div>
        <div class="input-group">
          <label>베이스플레이트 W/D (mm)</label>
          <div class="row2">
            <input type="number" id="basePlateW" value="200" title="베이스플레이트 가로폭 W">
            <input type="number" id="basePlateD" value="120" title="베이스플레이트 세로폭 D">
          </div>
        </div>

        <div class="input-group">
          <label>베이스 플레이트 두께 (mm)</label>
          <input type="number" id="basePlateT" value="10">
        </div>
      </div>
    </details>

    <!-- 4) 난간 가로재(각관) -->
    <details class="acc">
      <summary>
        <span>4. 난간 가로재(각관)</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>가로재 각관 W/H (mm)</label>
          <div class="row2">
            <input type="number" id="railW" value="50" title="레일 폭 W (Z)">
            <input type="number" id="railH" value="20" title="레일 높이 H (Y)">
          </div>
        </div>
        <div class="input-group">
          <label>시작 높이 (mm) <span style="font-weight:400;">(하부레일 하단 기준)</span></label>
          <input type="number" id="railStartY" value="80">
        </div>
      </div>
    </details>

    <!-- 5) 살 모듈(ㅁ자) -->
    <details class="acc">
      <summary>
        <span>5. 살 모듈 (ㅁ자)</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>평철 폭 / 두께 (mm)</label>
          <div class="row2">
            <input type="number" id="barW" value="45" title="평철 폭">
            <input type="number" id="barT" value="6" title="평철 두께">
          </div>
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 가로폭 (mm) <span style="font-weight:400;">(세로부재 중심-중심)</span></label>
          <input type="number" id="moduleW" value="100">
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 높이 (mm) <span style="font-weight:400;">(가로부재 중심-중심)</span></label>
          <input type="number" id="moduleH" value="900">
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 간격 (mm) <span style="font-weight:400;">(모듈-모듈 사이)</span></label>
          <input type="number" id="moduleGap" value="100">
        </div>
      </div>
    </details>

    <div class="info-box">
      * 상부레일 최상단이 "난간 높이"에 맞춰집니다.<br>
      * 포스트 높이는 자동 계산됩니다(난간 높이 - 상부레일 높이).<br>
      * 모듈 개수는 포스트 사이 유효 길이에 맞춰 자동 센터링됩니다.
    </div>
  </aside>

  <main id="canvas-container" style="padding-top:56px;">
    <div id="loading" class="loading-overlay">모델 데이터를 불러오는 중...</div>
  </main>

  <!-- three core -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- three examples (non-module) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <!-- VRButton 필요(우리 vr.js는 자체 버튼도 쓰지만, 안전하게 VRButton도 로드) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/webxr/VRButton.js"></script>

  <!-- split scripts -->
  <!-- 경로는 너의 폴더 구조에 맞게: 예) ./js/app.js, ./js/vr.js -->
  <script src="./js/app.js"></script>
  <script src="./js/vr.js"></script>
</body>

</html>
