<!-- railings/post-double-rail-rectframe/index.html -->
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>각관-평철 이중모듈 난간 | 고래이음 난간 시뮬레이터</title>

  <link rel="stylesheet" href="../../shared/css/app.css" />

  <style>
    :root {
      --leftW: 320px;
      --rightW: 360px;
      --topbarH: 56px;
      --edgeGap: 0px;
      /* 패널과 버튼 사이 간격 (0이면 딱 붙음) */
      --edgeOverlap: 0px;
      /* 버튼을 패널 쪽으로 얼마나 겹칠지 (+면 더 안쪽) */
    }

    body {
      margin: 0;
      display: flex;
      font-family: 'Pretendard', sans-serif;
      background: #f8f9fa;
      color: #333;
      min-height: 100vh;
    }

    #sidebar {
      width: var(--leftW);
      flex: 0 0 var(--leftW);
      flex-shrink: 0;

      padding: 18px 18px 22px;
      background: #fff;
      height: 100vh;
      overflow-y: auto;
      box-shadow: 2px 0 15px rgba(0, 0, 0, .05);
      z-index: 100;
      box-sizing: border-box;
    }


    /* ===== Canvas ===== */
    #canvas-container {
      flex: 1 1 auto;
      /* 가운데만 늘고 줄게 */
      min-width: 0;
      /* overflow 방지 */
      position: relative;
      background: #eee;
      padding-top: var(--topbarH);
    }


    /* ===== Right quote panel ===== */
    #quote-panel {
      width: var(--rightW);
      flex: 0 0 var(--rightW);
      flex-shrink: 0;

      padding: 18px 18px 22px;
      background: #fff;
      height: 100vh;
      overflow-y: auto;
      box-shadow: -2px 0 15px rgba(0, 0, 0, .05);
      z-index: 100;
      border-left: 1px solid #eef1f4;
      box-sizing: border-box;
    }


    /* ===== Topbar ===== */
    header.topbar {
      position: fixed;
      left: var(--leftW);
      right: var(--rightW);
      top: 0;
      height: var(--topbarH);
      z-index: 250;
    }

    /* ===== inputs ===== */
    .input-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
      font-weight: 700;
    }

    input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      box-sizing: border-box;
      font-size: 14px;
    }

    input[type="number"]:focus {
      border-color: #007bff;
      outline: none;
    }

    .pageTitle {
      font-size: 16px;
      font-weight: 900;
      margin: 8px 0 4px;
    }

    .pageSub {
      font-size: 12px;
      color: #777;
      margin: 0 0 14px;
      line-height: 1.5;
    }

    .row2 {
      display: flex;
      gap: 8px;
    }

    .row2 input {
      width: 50%;
    }

    .info-box {
      font-size: 11px;
      color: #888;
      line-height: 1.6;
      background: #f1f3f5;
      padding: 10px;
      border-radius: 10px;
      margin-top: 14px;
    }

    .loading-overlay {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, .82);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
      visibility: hidden;
      font-weight: 900;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f1f3f5;
      color: #495057;
      margin-top: 8px;
    }

    /* ===== Sidebar Sections (Accordion) ===== */
    .acc {
      border: 1px solid #e9ecef;
      border-radius: 12px;
      background: #fff;
      overflow: hidden;
      margin: 10px 0;
    }

    .acc>summary {
      list-style: none;
      cursor: pointer;
      user-select: none;
      padding: 12px 12px;
      font-size: 13px;
      font-weight: 900;
      color: #343a40;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #f8f9fa;
      border-bottom: 1px solid #eef1f4;
    }

    .acc>summary::-webkit-details-marker {
      display: none;
    }

    .acc>summary .chev {
      font-weight: 900;
      color: #868e96;
      transform: rotate(0deg);
      transition: transform .15s ease;
    }

    .acc[open]>summary .chev {
      transform: rotate(90deg);
    }

    .acc-body {
      padding: 12px;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn-mini {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      background: #f3f5f7;
      color: #222;
      font-weight: 900;
      cursor: pointer;
      user-select: none;
      flex: 1;
      min-width: 88px;
    }

    .btn-mini.on {
      background: #e7f1ff;
      border-color: #a8ccff;
      color: #0b57d0;
    }

    .step-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #f1f3f5;
      margin-top: 10px;
      font-size: 12px;
      color: #495057;
      font-weight: 900;
    }

    .step-pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid #e9ecef;
      color: #0b57d0;
      font-weight: 900;
      font-size: 12px;
      min-width: 56px;
      text-align: center;
    }

    .tiny-help {
      font-size: 11px;
      color: #888;
      line-height: 1.5;
      margin-top: 10px;
      word-break: break-word;
    }

    /* ===== Quote panel header ===== */
    .quote-head {
      margin-bottom: 12px;
    }

    .quote-title {
      font-size: 16px;
      font-weight: 900;
      margin: 8px 0 2px;
    }

    .quote-sub {
      font-size: 12px;
      color: #777;
      margin: 0 0 10px;
      line-height: 1.4;
    }

    /* ===== Edge toggle buttons (❮ ❯, 패널 옆면에 붙음) ===== */
    .edge-toggle {
      position: fixed;
      top: calc(var(--topbarH) + 12px);
      z-index: 400;

      width: 30px;
      height: 64px;

      border-radius: 12px;
      border: 1px solid #e0e0e0;
      background: rgba(255, 255, 255, .95);

      font-weight: 900;
      font-size: 18px;
      line-height: 1;
      cursor: pointer;

      display: grid;
      place-items: center;

      box-shadow: 0 8px 18px rgba(0, 0, 0, .08);
      user-select: none;
    }

    /* ✅ left 패널의 오른쪽 경계에 딱 붙기 */
    .edge-toggle.left {
      left: calc(var(--leftW) - var(--edgeOverlap) + var(--edgeGap));
    /*   transform: translateX(0%); */
      /* 버튼의 오른쪽 면이 경계에 붙음 */
    }

    /* ✅ right 패널의 왼쪽 경계에 딱 붙기 */
    .edge-toggle.right {
      right: calc(var(--rightW) - var(--edgeOverlap) + var(--edgeGap));
/*       transform: translateX(100%); */
      /* 버튼의 왼쪽 면이 경계에 붙음 */
    }


    body.left-collapsed .edge-toggle.left {
      left: 0;
      transform: translateX(0);
      /* 화면 왼쪽에 붙음 */
    }

    body.right-collapsed .edge-toggle.right {
      right: 0;
      transform: translateX(0);
      /* 화면 오른쪽에 붙음 */
    }


    /* ===== Collapsed states: 패널 폭 자체를 0으로 ===== */
    body.left-collapsed {
      --leftW: 0px;
    }

    body.right-collapsed {
      --rightW: 0px;
    }

    /* 접힐 때 내용/패딩/그림자 정리 */
    body.left-collapsed #sidebar {
      width: 0 !important;
      flex-basis: 0 !important;
      padding: 0 !important;
      border: 0 !important;
      overflow: hidden !important;
      box-shadow: none !important;
    }

    body.right-collapsed #quote-panel {
      width: 0 !important;
      flex-basis: 0 !important;
      padding: 0 !important;
      border: 0 !important;
      overflow: hidden !important;
      box-shadow: none !important;
    }

    /* topbar도 같이 확장 */
    body.left-collapsed header.topbar {
      left: 0 !important;
    }

    body.right-collapsed header.topbar {
      right: 0 !important;
    }

    /* 둘 다 접히면 topbar는 전체 */
    body.left-collapsed.right-collapsed header.topbar {
      left: 0 !important;
      right: 0 !important;
    }

    #sidebar,
    #quote-panel,
    header.topbar {
      transition: width .18s ease, left .18s ease, right .18s ease, padding .18s ease;
    }


    /* 호버 */
    .edge-toggle:hover {
      background: #fff;
    }
  </style>
</head>

<body>
  <header class="topbar">
    <a class="brand" href="#" id="brandLink">고래이음</a>
    <nav class="nav">
      <a href="#" id="homeLink">Home</a>
      <a class="active" href="../">Back</a>
    </nav>
  </header>

  <!-- LEFT: settings -->
  <aside id="sidebar">
    <div class="badge">Railing / Post + Double Rail + RectFrame</div>
    <div class="pageTitle">각관-평철 이중모듈 난간</div>
    <p class="pageSub">
      포스트(각관) + 3단 가로재(하/중/상) + ㅁ자 모듈.<br>
      값 변경 시 3D 모델이 실시간 업데이트됩니다.
    </p>

    <!-- 1) 보기/공정(항상 펼침) -->
    <details class="acc" open>
      <summary>
        <span>1. 보기 및 공정 시뮬</span>
        <span class="chev">›</span>
      </summary>

      <div class="acc-body">
        <div class="input-group" style="margin-top:0;">
          <label>색상 / 사람</label>
          <div style="display:flex; gap:10px; align-items:center;">
            <input type="color" id="allColor" value="#666666" style="flex:1; height:42px;" />
            <button id="btnHuman" class="btn-mini on" type="button" style="flex:0; min-width:110px;">사람 ON</button>
          </div>
        </div>

        <div class="step-box" style="margin-top:10px;">
          <span>단계</span>
          <span class="step-pill" id="buildStepLabel">0 / 5</span>
        </div>

        <div class="btn-row" style="margin-top:10px;">
          <button id="btnStepPrev" class="btn-mini" type="button">Prev</button>
          <button id="btnStepNext" class="btn-mini" type="button">Next</button>
          <button id="btnStepReset" class="btn-mini" type="button">Reset</button>
        </div>

        <div class="btn-row" style="margin-top:12px;">
          <button id="btnPosts" class="btn-mini on" type="button">포스트 ON</button>
          <button id="btnRailBot" class="btn-mini on" type="button">하부레일 ON</button>
          <button id="btnSlats" class="btn-mini on" type="button">ㅁ자모듈 ON</button>
          <button id="btnRailMid" class="btn-mini on" type="button">중간레일 ON</button>
          <button id="btnRailTop" class="btn-mini on" type="button">상부레일 ON</button>
        </div>

        <div class="tiny-help">
          * 단계(0~5): 0=없음 → 1=포스트 → 2=하부레일 → 3=ㅁ자모듈 → 4=중간레일 → 5=상부레일<br>
          * 토글을 수동으로 누르면 단계는 0으로 초기화됩니다.
        </div>
      </div>
    </details>

    <!-- 2) 전체 설정 -->
    <details class="acc">
      <summary>
        <span>2. 전체 설정</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>전체 길이 (mm)</label>
          <input type="number" id="totalL" value="3300">
        </div>
        <div class="input-group">
          <label>난간 높이 (mm) <span style="font-weight:400;">(상부레일 최상단 기준)</span></label>
          <input type="number" id="height" value="1200">
        </div>
      </div>
    </details>

    <!-- 3) 포스트 설정 -->
    <details class="acc">
      <summary>
        <span>3. 포스트 설정</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>포스트 간격 (mm)</label>
          <input type="number" id="postInt" value="1100">
        </div>
        <div class="input-group">
          <label>포스트 각관 W/H (mm)</label>
          <div class="row2">
            <input type="number" id="postW" value="20" title="포스트 폭 W">
            <input type="number" id="postH" value="50" title="포스트 높이 H">
          </div>
        </div>
        <div class="input-group">
          <label>베이스플레이트 W/D (mm)</label>
          <div class="row2">
            <input type="number" id="basePlateW" value="200" title="베이스플레이트 가로폭 W">
            <input type="number" id="basePlateD" value="120" title="베이스플레이트 세로폭 D">
          </div>
        </div>

        <div class="input-group">
          <label>베이스 플레이트 두께 (mm)</label>
          <input type="number" id="basePlateT" value="10">
        </div>
      </div>
    </details>

    <!-- 4) 난간 가로재(각관) -->
    <details class="acc">
      <summary>
        <span>4. 난간 가로재(각관)</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>가로재 각관 W/H (mm)</label>
          <div class="row2">
            <input type="number" id="railW" value="50" title="레일 폭 W (Z)">
            <input type="number" id="railH" value="20" title="레일 높이 H (Y)">
          </div>
        </div>
        <div class="input-group">
          <label>시작 높이 (mm) <span style="font-weight:400;">(하부레일 하단 기준)</span></label>
          <input type="number" id="railStartY" value="80">
        </div>
      </div>
    </details>

    <!-- 5) 살 모듈(ㅁ자) -->
    <details class="acc">
      <summary>
        <span>5. 살 모듈 (ㅁ자)</span>
        <span class="chev">›</span>
      </summary>
      <div class="acc-body">
        <div class="input-group">
          <label>평철 폭 / 두께 (mm)</label>
          <div class="row2">
            <input type="number" id="barW" value="45" title="평철 폭">
            <input type="number" id="barT" value="6" title="평철 두께">
          </div>
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 가로폭 (mm) <span style="font-weight:400;">(세로부재 중심-중심)</span></label>
          <input type="number" id="moduleW" value="100">
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 높이 (mm) <span style="font-weight:400;">(가로부재 중심-중심)</span></label>
          <input type="number" id="moduleH" value="900">
        </div>

        <div class="input-group">
          <label>ㅁ자 모듈 간격 (mm) <span style="font-weight:400;">(모듈-모듈 사이)</span></label>
          <input type="number" id="moduleGap" value="100">
        </div>
      </div>
    </details>

    <div class="info-box">
      * 상부레일 최상단이 "난간 높이"에 맞춰집니다.<br>
      * 포스트 높이는 자동 계산됩니다(난간 높이 - 상부레일 높이).<br>
      * 모듈 개수는 포스트 사이 유효 길이에 맞춰 자동 센터링됩니다.
    </div>
  </aside>

  <!-- CENTER: canvas -->
  <main id="canvas-container">
    <div id="loading" class="loading-overlay">모델 데이터를 불러오는 중...</div>
  </main>

  <!-- RIGHT: quote -->
  <aside id="quote-panel" aria-label="견적 패널">
    <div class="quote-head">
      <div class="quote-title">견적</div>
      <div class="quote-sub">설정값 변경 시 자동으로 재산출됩니다.</div>
    </div>

    <div class="acc-body" style="padding:0;">
      <div class="btn-row">
        <button id="btnQuote" class="btn-mini on" type="button">견적 계산</button>
      </div>

      <div class="step-box" style="margin-top:10px;">
        <span>총액(VAT포함)</span>
        <span class="step-pill" id="quoteTotal">-</span>
      </div>

      <div class="tiny-help" id="quoteBreakdown" style="margin-top:10px;"></div>
      <div class="tiny-help" id="quoteBOM" style="margin-top:10px;"></div>
    </div>
  </aside>

  <!-- Panel edge toggle buttons (붙는 탭 스타일) -->
  <button id="btnToggleLeft" class="edge-toggle left" type="button" aria-label="왼쪽 패널 토글">❮</button>
  <button id="btnToggleRight" class="edge-toggle right" type="button" aria-label="오른쪽 패널 토글">❯</button>


  <!-- three core -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <!-- three examples (non-module) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/webxr/VRButton.js"></script>

  <!-- split scripts -->
  <script src="./js/app.js"></script>
  <script src="./js/vr.js"></script>

  <!-- shared quote modules -->
  <script src="../../shared/quote/quote-core.js"></script>
  <script src="../../shared/quote/quote-ui.js"></script>

  <!-- model quote logic -->
  <script src="./js/quote-model.js"></script>

  <!-- panel toggle logic -->
  <script>
    (() => {
      const btnL = document.getElementById('btnToggleLeft');
      const btnR = document.getElementById('btnToggleRight');

      function syncIcons() {
        const leftCollapsed = document.body.classList.contains('left-collapsed');
        const rightCollapsed = document.body.classList.contains('right-collapsed');

        // ✅ 왼쪽 UI
        // 펼쳐져 있으면 "접기" 방향 = ❮
        // 접혀 있으면 "펼치기" 방향 = ❯
        btnL.textContent = leftCollapsed ? '❯' : '❮';

        // ✅ 오른쪽 UI
        // 펼쳐져 있으면 "접기" 방향 = ❯
        // 접혀 있으면 "펼치기" 방향 = ❮
        btnR.textContent = rightCollapsed ? '❮' : '❯';
      }

      btnL.addEventListener('click', () => {
        document.body.classList.toggle('left-collapsed');
        syncIcons();
        window.dispatchEvent(new Event('resize'));
      });

      btnR.addEventListener('click', () => {
        document.body.classList.toggle('right-collapsed');
        syncIcons();
        window.dispatchEvent(new Event('resize'));
      });

      syncIcons();
    })();
  </script>

</body>

</html>